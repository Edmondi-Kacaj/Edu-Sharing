
<div #drag class="dragBadge"><span>{{currentDrag}}</span><div>{{currentDragCount}}</div></div>

<div class="dialog darken" *ngIf="reorderDialog">
  <div class="card center-card card-action">
    <div class="card-content">
      <div class="card-cancel" (click)="closeReorder(false)"><i class="material-icons">close</i></div>
      <span class="card-title ">{{'LIST.REORDER_TITLE' | translate }}</span>
      <div class="hint">{{'LIST.REORDER_DRAG_DROP' | translate }}</div>
      <div *ngFor="let item of columnsAll;let i=index;"
           class="checkbox"
           [draggable]="i>0"
           (dragend)="currentDragColumn=null"
           (dragover)="allowDragColumn($event,i,item)" (drop)="dropColumn($event,i,item)"
           (dragstart)="dragStartColumn($event,i,item)"
      >
        <input type="checkbox" class="filled-in" id="{{item.name}}" disabled="{{i==0}}" [(ngModel)]="item.visible"><label for="{{item.name}}">{{item.type+"."+item.name | translate}}</label>
      </div>
    </div>
    <div class="card-action">
      <a class="btn"
         tabindex="0"
         (keyup.enter)="closeReorder(true)"
         (click)="closeReorder(true)"
      >{{'SAVE' | translate}}</a>
      <a class="btn-flat"
         tabindex="0"
         (keyup.enter)="closeReorder(false)"
         (click)="closeReorder(false)"
      >{{'CANCEL' | translate}}</a>
    </div>
  </div>
</div>
<div class="dialog dialogMore" *ngIf="dropdown" (click)="dropdown=null" (contextmenu)="dropdown=null;$event.preventDefault();$event.stopPropagation();"></div>
<div [className]="'list '+listClass" infinite-scroll [infiniteScrollDistance]="1" [infiniteScrollThrottle]="100" [scrollWindow]="scrollWindow" (scrolled)="scroll()">
  <div class="heading" *ngIf="hasHeading && viewType==0">
    <div class="checkbox" *ngIf="hasCheckbox">
      <input *ngIf="_nodes.length" id="selectAll" (click)="toggleAll()" type="checkbox" class="filled-in" [checked]="selectedNodes.length==_nodes.length"/>
      <label for="selectAll">&nbsp;</label>
    </div>
    <div class="checkboxDummy" *ngIf="!hasCheckbox">&nbsp;</div>
    <div class="icon" *ngIf="hasIcon">&nbsp;</div>
    <div *ngFor="let item of columnsVisible;let i = index"
         class="{{getItemCssClass(item)}} row_{{i+1}}">
      <a class="text" [class.clickable]="canBeSorted(item.name)" (click)="setSorting(item.name)">{{item.type+"."+item.name | translate}}</a>
      <div *ngIf="sortBy" class="sorting" (click)="setSorting(item.name)">
        <a class="" *ngIf="sortBy==item.name && sortAscending"><i class="material-icons">arrow_drop_up</i></a>
        <a class="" *ngIf="sortBy==item.name && !sortAscending"><i class="material-icons">arrow_drop_down</i></a>
      </div>
    </div>
    <div *ngFor="let option of optionsAlways"  class="more moreAlways" > </div>
    <div class="more" *ngIf="_options && _options.length">&nbsp;</div>
    <div class="removeColumn" *ngIf="currentDragColumn && reorderColumns"
         (dragover)="allowDeleteColumn($event)" (drop)="deleteColumn($event)"
    ><i class="material-icons">delete</i></div>
    <div class="editColumns clickable" *ngIf="!currentDragColumn && reorderColumns && columnsVisible && columnsVisible.length"
         (click)="reorderDialog=true"
    ><i class="material-icons">settings</i></div>
  </div>
  <div [class.cardContainer]="viewType==1 || viewType==2" *ngIf="!reorderDialog">
    <div *ngFor="let node of _nodes; let i = index" class="collection-item rowFrame"
         [class.nodeCollection]="node.collection"
         [style.backgroundColor]="node.collection ? (viewType==2 ? node.preview.isIcon ? node.collection.color : '#000' : node.collection.color) : null"
         [style.border-color]="node.collection ? node.collection.color : null"
         [class.cardList]="viewType==1"
         [class.cardSmallList]="viewType==2"
         [class.hover]="dragHover==node">
  <div class="collectionContainer"
     *ngIf="dropdown==node && _options && _options.length"
     (click)="dropdown=null" (contextmenu)="dropdown=null;$event.preventDefault();$event.stopPropagation();"
  >
      <div class="moreOpen collection"
           #dropdown
           *ngIf="dropdown==node && _options && _options.length"
           [@openOverlay]="dropdown==node && dropdownBottom==null"
           [style.position]="dropdownPosition"
           [style.left]="dropdownLeft"
           [style.top]="dropdownTop"
           [style.bottom]="dropdownBottom"
      >
        <a class="collection-item"
           [class.collection-item-seperate-bottom]="option.isSeperateBottom && i"
           [class.collection-item-seperate]="option.isSeperate && i"
           *ngFor="let option of _options;let i=index"
           [class.disabled]="!optionIsValid(option,node)"
           [style.display]="optionIsShown(option,node) ? '' : 'none'"
           (contextmenu)="callOption(option,node);$event.preventDefault();$event.stopPropagation();"
           (click)="callOption(option,node)">
          <i class="material-icons">{{option.icon}}</i> {{option.name | translate}}</a>
      </div>
    </div>
      <div class="row waves-effect"
           [class.noCCPublish]="applyMode && node.access.indexOf('CCPublish')==-1"
           [class.selected]="getSelectedPos(node)!=-1"
           [title]="viewType==0 ? '' : getTitle(node)"
           [draggable]="dragDrop"
           (dragend)="dragHover=null"
           (dragexit)="dragHover=null"
           (dragleave)="dragHover=null"
           (contextmenu)="contextMenu($event,node)"
           (dragover)="allowDrag($event,node)" (drop)="drop($event,node)" (dragstart)="dragStart($event,node)" tabindex="0" (keypress)="($event.which === 13)?doubleClick(node):0">
        <div *ngIf="viewType==1 && !node.collection" class="typeicon column">
          <img src="{{node.iconURL}}" [attr.role]="presentation" alt="">
        </div>
        <div *ngIf="node.collection && node.collection.pinned" class="collectionPinned"><custom-icon iconId="pin"></custom-icon></div>
        <div class="checkbox column" *ngIf="hasCheckbox">
          <input (click)="select(node,true)" type="checkbox" class="filled-in" [attr.id]="id+'select'+i"
                 checked="{{getSelectedPos(node)!=-1 ? 'checked' : ''}}"/>
          <label [attr.for]="id+'select'+i">&nbsp;</label>
        </div>
        <div class="checkboxDummy column" *ngIf="!hasCheckbox"></div>
        <div class="preview column" *ngIf="viewType==1 || viewType==2" [class.clickable]="isClickable" (dblclick)="doubleClick(node)" (click)="select(node,false)" >
          <img *ngIf="node.preview.url && !(node.collection && node.preview.isIcon) || (viewType==2 && !node.preview.isIcon)"
               src="{{(!node.collection || !node.preview.isIcon) ? node.preview.url+(node.ref.repo=='local' || node.ref.isHomeRepo ? '&crop=true&width=200&height=150' : '') : null}}"
               [attr.role]="presentation"
               [class.blurred]="applyMode && node.access.indexOf('CCPublish')==-1"
               alt="{{'SEARCH.PREVIEWIMAGE_FOR' | translate}} {{ node.title }}"/>
          <div class="previewCollectionContainer" *ngIf="node.collection && node.preview.isIcon && viewType!=2">
            <div class="previewCollection" [style.backgroundColor]="node.collection.color">
              <i class="material-icons">layers</i>
            </div>
          </div>
          <div class="ccPublishMissing" *ngIf="applyMode && node.access.indexOf('CCPublish')==-1">
            <div>
              <i class="material-icons">security</i>
              <div>{{'NO_CC_PUBLISH' | translate }}</div>
              <a *ngIf="node.properties['ccm:questionsallowed'] && node.properties['ccm:questionsallowed'][0]=='true'"
                 (click)="askCCPublish($event,node)"
              ><i class="material-icons">message</i> {{ 'ASK_CC_PUBLISH' | translate}}</a>
            </div>
          </div>
        </div>
        <div class="icon column" *ngIf="hasIcon && viewType==0" [class.clickable]="isClickable" (dblclick)="doubleClick(node)" (click)="select(node,false)">
          <div class="icon-bg">
            <img *ngIf="node.iconURL && !node.collection" src="{{node.iconURL}}" [attr.role]="presentation" alt="{{'SEARCH.PREVIEWIMAGE_FOR' | translate}} {{node.title}}"/>
            <i *ngIf="!node.collection && icon" class="material-icons">{{icon}}</i>
            <i *ngIf="node.collection" class="material-icons" [style.color]="node.collection.color">layers</i>
          </div>
        </div>
        <div *ngFor="let item of columnsVisible;let i = index" class="column {{getItemCssClass(item)}} row_{{i+1}}" [class.clickable]="isClickable" (dblclick)="doubleClick(node)" (click)="select(node,false)">
          <div class="hiddendiv" [attr.property]="getLRMIProperty(node,item)">{{getLRMIAttribute(node,item)}}</div>
          <div class="rowInner" [innerHTML]="getAttribute(node,item)"></div>
        </div>
        <div *ngFor="let option of optionsAlways"
             class="more moreAlways column"
             [style.opacity]="optionIsShown(option,node) ? 1 : 0"
             (click)="optionIsShown(option,node) ? callOption(option,node) : null">
          <i class="material-icons">{{option.icon}}</i>
        </div>

        <div class="more column" *ngIf="_options && _options.length>1"><a (click)="showDropdown(node)"><i class="material-icons">more_vert</i></a></div>
        <div class="more moreSingle column" *ngIf="_options && _options.length==1 && optionIsShown(_options[0],node)"><a [class.disabled]="!optionIsValid(_options[0],node)" (click)="callOption(_options[0],node)"><i class="material-icons">{{_options[0].icon}}</i> <span class="actionText">{{_options[0].name | translate}}</span></a></div>
      </div>
    </div>
    <div *ngIf="_nodes && _nodes.length && hasMore && !isLoading" class="clickable loadMore" (click)="scroll()">
      <i class="material-icons">refresh</i>
      <div>{{'LOAD_MORE' | translate}}</div>
    </div>
    <spinner *ngIf="isLoading"></spinner>
  </div>
</div>

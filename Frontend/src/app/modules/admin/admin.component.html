<main-nav
    #mainNav
    [title]="'ADMIN.TITLE'"
    [currentScope]="'admin'"
    [searchEnabled]="false"
    xmlns="http://www.w3.org/1999/html"></main-nav>
<modal-dialog
              [title]="showWarning ? 'ADMIN.WARNING_TITLE' : null"
              [message]="'ADMIN.WARNING_INFO'"
              [buttons]="warningButtons"
              [isCancelable]="false"
></modal-dialog>
<card width="normal" height="xxlarge" [buttons]="xmlCardButtons" [isCancelable]="true" (onCancel)="xmlAppProperties=null" title="{{'ADMIN.APPLICATIONS.EDIT_APP' | translate:{xml:currentAppXml} }}" *ngIf="xmlAppProperties">
    <div class="card-content-padding card-xml">
        <div class="warning">{{'ADMIN.APPLICATIONS.APP_XML_WARNING' | translate}}</div>
        <div *ngFor="let value of xmlAppKeys;let i=index;" class="appEditor">
            <mat-form-field class="mat-input-group">
                <mat-label>{{value}}</mat-label>
                <textarea matInput
                          cdkTextareaAutosize
                          cdkAutosizeMinRows="2"
                          cdkAutosizeMaxRows="5" *ngIf="isMultilineProperty(value)" class="materialize-textarea" [(ngModel)]="xmlAppProperties[value]"></textarea>
                <input matInput *ngIf="!isMultilineProperty(value)" type="text" [(ngModel)]="xmlAppProperties[value]">
                <!-- Api does currently not support deleting -->
                <i class="material-icons clickable" (click)="removeAppProperty(i)" *ngIf="false">delete</i>
                <mat-hint *ngIf="currentApp">{{'ADMIN.APPLICATIONS.'+currentApp+"."+value | translate}}</mat-hint>
            </mat-form-field>
        </div>
        <div class="add-property">
            <div class="property">{{'ADMIN.APPLICATIONS.ADD_PROPERTY' | translate}}</div>
            <mat-form-field>
                <mat-label>{{'ADMIN.APPLICATIONS.PROPERTY_NAME_PLACEHOLDER' | translate}}</mat-label>
                <input matInput type="text" id="additionalProperty" [(ngModel)]="xmlAppAdditionalPropertyName">
            </mat-form-field>
            <mat-form-field>
                <mat-label>{{'ADMIN.APPLICATIONS.PROPERTY_VALUE_PLACEHOLDER' | translate}}</mat-label>
                <input matInput type="text" [(ngModel)]="xmlAppAdditionalPropertyValue">
            </mat-form-field>
        </div>
    </div>
</card>
<node-info *ngIf="nodeInfo"
    [node]="nodeInfo"
    (onClose)="nodeInfo=null"
></node-info>
<modal-dialog
[title]="dialogTitle"
[message]="dialogMessage"
[buttons]="dialogButtons"
[messageParameters]="dialogParameters"
[isCancelable]="true"
(onCancel)="dialogTitle=null"
></modal-dialog>
<file-chooser *ngIf="chooseDirectory"
[isCancelable]="true"
[title]="'ADMIN.IMPORT.CHOOSE_DIRECTORY'"
[pickDirectory]="true"
(onCancel)="chooseDirectory=false"
(onChoose)="pickDirectory($event)"
></file-chooser>
<file-chooser *ngIf="chooseCollection"
              [isCancelable]="true"
              [title]="'ADMIN.IMPORT.CHOOSE_COLLECTION'"
              [collections]="true"
              (onCancel)="chooseCollection=false"
              (onChoose)="pickCollection($event)"
></file-chooser>
<div class="main">
<div class="main-nav">
    <div>
        <div matRipple matRippleColor="primary" *ngFor="let button of buttons" class="button clickable" [class.active]="mode==button.id" tabindex="0" (click)="setMode(button.id)" (keyup.enter)="setMode(button.id)">
            <i icon [iconId]="button.icon"></i><span>{{('ADMIN.MODE.'+button.id) | translate }}</span>
        </div>
    </div>
</div>
<div class="main-content main-content-{{mode ? mode.toLowerCase() : 'default'}}">
<!-- for dynamically added components from extensions -->
<ng-template *ngIf="getModeButton() && getModeButton().factory" #dynamic></ng-template>
<div *ngIf="mode=='INFO'" class="content info">
  <div class="heading">{{'ADMIN.INFO.REPOSITORY' | translate}}</div>
  <div class="version">{{ repositoryVersion }}</div>
  <div class="heading">{{'ADMIN.INFO.NG' | translate}}</div>
  <div class="version">{{ ngVersion }}</div>
  <div class="heading">{{'ADMIN.INFO.SYSTEM_CHECKS' | translate}}</div>
  <div class="checks">
      <div class="reload"><i class="material-icons clickable" (click)="runChecks()">refresh</i></div>
      <div *ngFor="let check of getSystemChecks();let ok=false;" class="check"
           [class.check-fail]="check.status=='FAIL'"
           [class.check-ok]="check.status=='OK'"
           [class.check-info]="check.status=='INFO'"
           [class.check-warn]="check.status=='WARN'">
            <div class="data">
                <div class="title">{{('ADMIN.INFO.CHECK.'+check.name+'.TITLE') | translate:check.translate }}</div>
                <div class="description">{{('ADMIN.INFO.CHECK.'+check.name+'.STATUS_'+check.status) | translate:check.translate }}</div>
                <div *ngIf="check.status!='OK' && check.status!='INFO'" class="solution">
                    <i class="material-icons">forward</i>
                    <div>
                    {{('ADMIN.INFO.CHECK.'+check.name+'.SOLUTION') | translate:check.translate }}
                    <a *ngIf="check.status!='OK' && check.callback" class="solution-link clickable" (click)="check.callback()">
                        {{('ADMIN.INFO.CHECK.'+check.name+'.SOLUTION_LINK') | translate:check.translate }}
                    </a>
                    </div>
                </div>
            </div>
            <i class="material-icons">{{check.status=='OK' ? 'check' : 'error_outline'}}</i>
        </div>
    </div>
</div>
<div *ngIf="mode=='CONFIG'" class="content config">
    <div class="heading"><i class="material-icons">build</i><span>{{'ADMIN.CONFIG.XML_CONFIG' | translate}}</span></div>
    <div class="group xml">
        <div *ngFor="let xml of editableXmls">
            <button mat-raised-button color="primary"
             (click)="editApp(xml)">{{'ADMIN.APPLICATIONS.EDIT_APP' | translate:{xml:xml.file} }}</button>
        </div>
    </div>
    <div class="heading"><i class="material-icons">mail</i><span>{{'ADMIN.CONFIG.TEST_MAIL' | translate}}</span></div>
    <div class="group">
        <form (ngSubmit)="testMail()" #mailForm>
            <div class="inputGroupGrow">
                <div class="info">{{'ADMIN.CONFIG.TEST_MAIL_RECEIVER' | translate }}</div>
                <mat-form-field>
                    <mat-label>{{'ADMIN.CONFIG.TEST_MAIL_RECEIVER_LABEL' | translate}}</mat-label>
                    <input matInput type="email" name="receiver" [(ngModel)]="mailReceiver">
                </mat-form-field>
            </div>
            <div class="inputGroupGrow">
                <div class="info">{{'ADMIN.CONFIG.TEST_MAIL_TEMPLATE' | translate }}</div>
                <mat-form-field>
                    <mat-label>{{'ADMIN.CONFIG.TEST_MAIL_TEMPLATE_LABEL' | translate}}</mat-label>
                    <mat-select name="template" [(ngModel)]="mailTemplate">
                        <mat-option *ngFor="let template of mailTemplates" [value]="template">{{template}}</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <button mat-raised-button color="primary" [class.disabled]="!mailReceiver || !mailTemplate" (click)="mailForm.submit()">{{'ADMIN.CONFIG.TEST_MAIL_SEND' | translate }}</button>
        </form>
    </div>
</div>
<div *ngIf="mode=='STATISTICS'" class="content statistics">
    <app-admin-statistics
        (onOpenNode)="debugNode($event)"
    ></app-admin-statistics>
</div>
<div *ngIf="mode=='MEDIACENTER'" class="content mediacenter">
    <app-admin-mediacenter
    ></app-admin-mediacenter>
</div>
<div *ngIf="mode=='FRONTPAGE'" class="content frontpage">
    <app-admin-frontpage
        (onOpenNode)="debugNode($event)"
    ></app-admin-frontpage>
</div>
<div *ngIf="mode=='GLOBAL_CONFIG'" class="content global-config">
    <app-admin-config></app-admin-config>
</div>
<div *ngIf="mode=='APPLICATIONS'" class="content applications">
  <input #xmlSelect type="file" style="display:none" id="xmlSelect" accept="application/xml" (change)="registerAppXml($event)" />
  <form class="register-app">
    <h4 class="mat-heading-4 mat-heading-underline">
      <span>{{'ADMIN.APPLICATIONS.ADD_APPLICATION' | translate}}</span>
    </h4>
    <div>
      <mat-form-field>
        <mat-label>{{'ADMIN.APPLICATIONS.URL' | translate}}</mat-label>
        <input matInput type="text" name="appUrl" [(ngModel)]="appUrl">
        <mat-hint>{{'ADMIN.APPLICATIONS.URL_HINT' | translate}}</mat-hint>
      </mat-form-field>
      <div><button mat-raised-button color="primary" (click)="registerApp()">{{'ADMIN.APPLICATIONS.ADD_URL' | translate}}</button></div>
    </div>
    <div><button mat-raised-button (click)="xmlSelect.click()">{{'ADMIN.APPLICATIONS.SELECT_XML' | translate}}</button></div>
    <div class="useFile">{{'ADMIN.APPLICATIONS.USE_FILE' | translate}}</div>
  </form>
  <form class="register-app">
    <h4 class="mat-heading-4 mat-heading-underline">
      <span>{{'ADMIN.APPLICATIONS.USE_OWN_URL' | translate}}</span>
    </h4>
      <mat-label>{{'ADMIN.APPLICATIONS.CHOOSE_APP_MODE' | translate}}</mat-label>
      <mat-radio-group name="ownAppMode" [(ngModel)]="ownAppMode">
          <mat-radio-button value="repository">{{'ADMIN.APPLICATIONS.APP_MODE.REPOSITORY' | translate}}</mat-radio-button>
          <mat-radio-button value="render">{{'ADMIN.APPLICATIONS.APP_MODE.RENDER' | translate}}</mat-radio-button>
          <mat-radio-button value="lms">{{'ADMIN.APPLICATIONS.APP_MODE.LMS' | translate}}</mat-radio-button>
      </mat-radio-group>
    <div>
      <mat-form-field>
        <mat-label>{{'ADMIN.APPLICATIONS.OWN_URL' | translate}}</mat-label>
        <input matInput type="text" name="ownAppUrl" [ngModel]="getOwnAppUrl()" readonly>
        <mat-hint>{{'ADMIN.APPLICATIONS.OWN_URL_HINT' | translate}}</mat-hint>
      </mat-form-field>
      <div><button mat-raised-button (click)="copyOwnApp()">{{'ADMIN.APPLICATIONS.COPY' | translate}}</button></div>
    </div>
  </form>
    <h4 class="mat-heading-4 mat-heading-underline">
        <span>{{'ADMIN.APPLICATIONS.LIST' | translate }}</span>
    </h4>
    <div *ngFor="let type of getAppTypes()">
        <div class="app-type">
        <h6 class="mat-heading-6">
            {{type}} ({{getApplications(type).length}})
        </h6>
            <button mat-icon-button color="primary">
                <i icon
                   [iconId]="applicationsOpen[type] ? 'keyboard_arrow_up' : 'keyboard_arrow_down'"
                   (click)="applicationsOpen[type]=!applicationsOpen[type]">
                </i>
            </button>
        </div>
        <div class="app-list" *ngIf="applicationsOpen[type]" [@openOverlay]="applicationsOpen[type]">
            <div class="header">

                <div class="id">{{'ADMIN.APPLICATIONS.ID' | translate}}</div>
                <div class="title">{{'ADMIN.APPLICATIONS.TITLE' | translate}}</div>
                <div class="file">{{'ADMIN.APPLICATIONS.FILE' | translate}}</div>
                <div class="repoType">{{'ADMIN.APPLICATIONS.REPOTYPE' | translate}}</div>
                <div class="subtype">{{'ADMIN.APPLICATIONS.SUBTYPE' | translate}}</div>
                <div class="config">&nbsp;</div>
                <div class="edit">&nbsp;</div>
                <div class="download">&nbsp;</div>
                <div class="delete">&nbsp;</div>
            </div>
            <div *ngFor="let app of getApplications(type)">
                <div class="id">{{app.id}}</div>
                <div class="title">{{app.title}}</div>
                <div class="file">{{app.file}}</div>
                <div class="repoType">{{app.repositoryType}}</div>
                <div class="subtype">{{app.subtype}}</div>
                <div class="config"><button mat-icon-button color="primary" *ngIf="app.configUrl" (click)="configApp(app)"><i icon iconId="settings" class="clickable"></i></button></div>
                <div class="edit"><button mat-icon-button color="primary" (click)="editApp(app)"><i icon iconId="edit" class="clickable" ></i></button></div>
                <div class="download"><button mat-icon-button color="primary" (click)="downloadApp(app)"><i icon iconId="cloud_download" class="clickable"></i></button></div>
                <div class="delete"><button mat-icon-button color="primary" (click)="removeApp(app)"><i icon iconId="delete" class="clickable"></i></button></div>
            </div>
        </div>
    </div>
</div>
<div *ngIf="mode=='UPDATE'" class="content update">
  <div class="hint">
    {{'ADMIN.UPDATE.HINT' | translate}}
  </div>
  <div class="table">
    <div class="tableRow header">
      <div class="id">{{'ADMIN.UPDATE.ID' | translate}}</div>
      <div class="description">{{'ADMIN.UPDATE.DESCRIPTION' | translate}}</div>
      <div class="date">{{'ADMIN.UPDATE.DATE' | translate}}</div>
      <div class="test">{{'ADMIN.UPDATE.TEST' | translate}}</div>
      <div class="run">{{'ADMIN.UPDATE.RUN' | translate}}</div>
    </div>
    <div *ngFor="let update of updates" class="tableRow" [class.table-not-executed]="!update.executedAt">
      <div class="id">{{update.id}}</div>
      <div class="description">{{update.description}}</div>
      <div class="date" *ngIf="!update.executedAt">{{'ADMIN.UPDATE.NOT_EXECUTED' | translate}}</div>
      <div class="date" *ngIf="update.executedAt">{{update.executedAt | formatDate}}</div>
      <div class="test"><button mat-button color="primary" (click)="runUpdate(update,false)">{{'ADMIN.UPDATE.TEST' | translate}}</button></div>
      <div class="run"><button mat-raised-button [class.disabled]="update.executedAt" (click)="runUpdate(update,true)">{{'ADMIN.UPDATE.RUN' | translate}}</button></div>
    </div>
  </div>
</div>
<div *ngIf="mode=='IMPORT'" class="content import">
  <div class="heading"><i class="material-icons">layers</i><span>{{'ADMIN.IMPORT.COLLECTION' | translate}}</span></div>
  <div class="collections">
    <input #xmlCollectionsSelect type="file" style="display:none" id="xmlCollectionsSelect" accept=".xml, .zip" (change)="updateCollectionsFile($event)">
    <div class="inputGroup">
      <button mat-raised-button (click)="xmlCollectionsSelect.click()">{{'ADMIN.IMPORT.CHOOSE_COLLECTIONS_XML' | translate}}</button>
      <div class="file">{{ (collectionsFile ? collectionsFile.name : '') }}</div>
    </div>
    <mat-radio-group class="inputGroup" [(ngModel)]="parentCollectionType">
      <mat-radio-button name="parentCollection" id="parentCollectionRoot" value="root">{{'ADMIN.IMPORT.PARENT_COLLECTION_ROOT' | translate}}</mat-radio-button>
      <mat-radio-button name="parentCollection" id="parentCollectionChoose" value="choose">{{'ADMIN.IMPORT.PARENT_COLLECTION_CHOOSE' | translate}}</mat-radio-button>
    </mat-radio-group>
    <div class="inputGroup" *ngIf="parentCollectionType=='choose'">
      <button mat-raised-button (click)="chooseCollection=true">{{'ADMIN.IMPORT.CHOOSE_COLLECTION' | translate}}</button>
      <div class="directory"><div *ngIf="parentCollection">{{ parentCollection.title}} ({{parentCollection.ref.id}})</div></div>
    </div>
    <button mat-raised-button color="primary" (click)="importCollections()">{{'ADMIN.IMPORT.COLLECTION_START' | translate}}</button>
  </div>
  <div class="heading"><i class="material-icons">table_chart</i><span>{{'ADMIN.IMPORT.EXCEL' | translate}}</span></div>
  <div class="csv">
    <input #csvSelect type="file" style="display:none" id="csvSelect" accept=".xls, .xlsx" (change)="updateExcelFile($event)">
    <div class="inputGroup">
      <button mat-raised-button (click)="csvSelect.click()">{{'ADMIN.IMPORT.CHOOSE_EXCEL' | translate}}</button>
      <div class="file">{{ (excelFile ? excelFile.name : '') }}</div>
    </div>
    <div class="inputGroup">
      <button mat-raised-button (click)="chooseDirectory=true">{{'ADMIN.IMPORT.CHOOSE_DIRECTORY' | translate}}</button>
      <div class="directory"><div *ngIf="parentNode">{{ parentNode.name}} ({{parentNode.ref.id}})</div></div>
    </div>
    <button mat-raised-button color="primary" (click)="importExcel()">{{'ADMIN.IMPORT.EXCEL_START' | translate}}</button>
  </div>
  <div class="heading"><i class="material-icons">description</i><span>{{'ADMIN.IMPORT.OAI' | translate}}</span></div>
  <div class="oai">
      <label>{{'ADMIN.IMPORT.OAI_XML' | translate}}</label>
      <input #uploadOaiSelect type="file" style="display:none" id="uploadOaiSelect" (change)="updateUploadOaiFile($event)">
      <div class="inputGroup">
          <button mat-raised-button (click)="uploadOaiSelect.click()">{{'ADMIN.TOOLKIT.CHOOSE_UPLOAD_TEMP' | translate}}</button>
          <div class="file">{{ (uploadOaiFile ? uploadOaiFile.name : '') }}</div>
      </div>
    <div *ngIf="!uploadOaiFile">
        <mat-form-field>
            <mat-label>{{'ADMIN.IMPORT.OAI_URL' | translate}}</mat-label>
            <input matInput type="text" [(ngModel)]="oai.url">
            <mat-hint>{{'ADMIN.IMPORT.OAI_URL_EXAMPLE' | translate}}</mat-hint>
        </mat-form-field>
        <mat-form-field>
            <mat-label>{{'ADMIN.IMPORT.OAI_SET' | translate}}</mat-label>
            <input matInput type="text" [(ngModel)]="oai.set">
        </mat-form-field>
        <mat-form-field>
            <mat-label>{{'ADMIN.IMPORT.OAI_PREFIX' | translate}}</mat-label>
            <input matInput type="text" [(ngModel)]="oai.prefix">
        </mat-form-field>
        <mat-form-field>
            <mat-label>{{'ADMIN.IMPORT.OAI_METADATA' | translate}}</mat-label>
            <input matInput type="text" [(ngModel)]="oai.metadata">
        </mat-form-field>
        <mat-form-field>
            <mat-label>{{'ADMIN.IMPORT.OAI_FILE' | translate}}</mat-label>
            <input matInput type="text" [(ngModel)]="oai.file">
        </mat-form-field>
        <mat-form-field>
            <mat-label>{{'ADMIN.IMPORT.OAI_IDS' | translate}}</mat-label>
            <input matInput type="text" [(ngModel)]="oai.ids">
        </mat-form-field>
        <mat-form-field>
            <mat-label>{{'ADMIN.IMPORT.OAI_CLASS_NAME' | translate}}</mat-label>
            <mat-select [(ngModel)]="oai.className">
                <mat-option *ngFor="let option of oaiClasses" [value]="option">{{ option }}</mat-option>
            </mat-select>
        </mat-form-field>
    </div>
    <mat-form-field>
        <mat-label>{{'ADMIN.IMPORT.OAI_IMPORTER_CLASS_NAME' | translate}}</mat-label>
        <input matInput type="text" [(ngModel)]="oai.importerClassName">
        <mat-hint>{{'ADMIN.IMPORT.OAI_RECORD_IMPORTER_CLASS_NAME_EXAMPLE' | translate}}</mat-hint>
    </mat-form-field>
    <mat-form-field>
        <mat-label>{{'ADMIN.IMPORT.OAI_RECORD_HANDLER_CLASS_NAME' | translate}}</mat-label>
        <input matInput type="text" [(ngModel)]="oai.recordHandlerClassName">
        <mat-hint>{{'ADMIN.IMPORT.OAI_RECORD_HANDLER_CLASS_NAME_EXAMPLE' | translate}}</mat-hint>
    </mat-form-field>
    <mat-form-field>
        <mat-label>{{'ADMIN.IMPORT.OAI_BINARY_HANDLER_CLASS_NAME' | translate}}</mat-label>
        <input matInput type="text" [(ngModel)]="oai.binaryHandlerClassName">
        <mat-hint>{{'ADMIN.IMPORT.OAI_BINARY_HANDLER_CLASS_NAME_EXAMPLE' | translate}}</mat-hint>
    </mat-form-field>
        <!--
        <label for="OAI_URL">{{'ADMIN.IMPORT.OAI_URL' | translate}}</label>
    <input type="text" id="OAI_URL" [(ngModel)]="oai.url">
    <div class="input-hint-bottom">{{'ADMIN.IMPORT.OAI_URL_EXAMPLE' | translate}}</div>
    <label for="OAI_SET">{{'ADMIN.IMPORT.OAI_SET' | translate}}</label>
    <input type="text" id="OAI_SET" [(ngModel)]="oai.set">
      <label for="OAI_PREFIX">{{'ADMIN.IMPORT.OAI_PREFIX' | translate}}</label>
      <input type="text" id="OAI_PREFIX" [(ngModel)]="oai.prefix">
      <label for="OAI_METADATA">{{'ADMIN.IMPORT.OAI_METADATA' | translate}}</label>
      <input type="text" id="OAI_METADATA" [(ngModel)]="oai.metadata">
      <label for="OAI_FILE">{{'ADMIN.IMPORT.OAI_FILE' | translate}}</label>
      <input type="text" id="OAI_FILE" [(ngModel)]="oai.file">
      <label for="OAI_IDS">{{'ADMIN.IMPORT.OAI_IDS' | translate}}</label>
      <input type="text" id="OAI_IDS" [(ngModel)]="oai.ids">
      <label for="OAI_CLASS_NAME">{{'ADMIN.IMPORT.OAI_CLASS_NAME' | translate}}</label>
      <select id="OAI_CLASS_NAME" [(ngModel)]="oai.className">
        <option *ngFor="let option of oaiClasses" [value]="option">{{ option }}</option>
      </select>
      <label for="OAI_SET">{{'ADMIN.IMPORT.OAI_IMPORTER_CLASS_NAME' | translate}}</label>
      <input type="text" id="OAI_IMPORTER_CLASS_NAME" [(ngModel)]="oai.importerClassName">
    </div>
    <label for="OAI_RECORD_HANDLER_CLASS_NAME">{{'ADMIN.IMPORT.OAI_RECORD_HANDLER_CLASS_NAME' | translate}}</label>
    <input type="text" id="OAI_RECORD_HANDLER_CLASS_NAME" [(ngModel)]="oai.recordHandlerClassName">
    <div class="input-hint-bottom"></div>

    <label for="OAI_BINARY_HANDLER_CLASS_NAME">{{'ADMIN.IMPORT.OAI_BINARY_HANDLER_CLASS_NAME' | translate}}</label>
    <input type="text" id="OAI_BINARY_HANDLER_CLASS_NAME" [(ngModel)]="oai.binaryHandlerClassName">
    <div class="input-hint-bottom">{{'ADMIN.IMPORT.OAI_BINARY_HANDLER_CLASS_NAME_EXAMPLE' | translate}}</div>
    -->
    <div class="oaiForce" *ngIf="!uploadOaiFile">
        <mat-checkbox [(ngModel)]="oai.forceUpdate">{{'ADMIN.IMPORT.OAI_FORCE_UPDATE' | translate}}</mat-checkbox>
    </div>
    <div class="oaiSave">
        <mat-checkbox [(ngModel)]="oaiSave">{{'ADMIN.IMPORT.OAI_SAVE' | translate}}</mat-checkbox>
    </div>
    <div class="actions">
        <button mat-raised-button (click)="removeImports()">{{'ADMIN.IMPORT.REMOVE_IMPORTS' | translate}}</button>
        <button mat-raised-button color="primary" (click)="oaiImport()">{{'ADMIN.IMPORT.OAI_START' | translate}}</button>
    </div>
  </div>
</div>
<div *ngIf="mode=='JOBS'" class="content jobs">
    <div class="heading"><i class="material-icons">done</i><span>{{'ADMIN.TOOLKIT.START_JOB' | translate}}</span></div>
    <div class="group">
        <form>
            <div class="inputGroupGrow">
                <div class="info">{{'ADMIN.TOOLKIT.JOB_CLASS' | translate }}</div>
                <div class="autocomplete">
                    <autocomplete
                            [suggestions]="jobClassesSuggested"
                            [allowAny]="true"
                            [inputMinLength]="1"
                            (updateInput)="updateJobSuggestions($event)"
                            (addItem)="job.name=$event.item.title;job.class=$event.item.id"
                            (addAny)="job.name='';job.class=$event"></autocomplete>
                    <div class="job-title" *ngIf="job && job.name">{{job.name | translate}}</div>
                    <div class="job-class" *ngIf="job && job.class">{{job.class}}</div>
                </div>
            </div>
            <mat-form-field>
                <textarea matInput
                      cdkTextareaAutosize
                      cdkAutosizeMinRows="2"
                      cdkAutosizeMaxRows="5"
                      name="jobParams" class="jobParams materialize-textarea" [(ngModel)]="job.params" placeholder='{"param1":"value1","param2":"value2"}'></textarea>
            </mat-form-field>
            <button mat-raised-button (click)="startJob()">{{'ADMIN.TOOLKIT.START_JOB' | translate }}</button>
        </form>
    </div>
    <div class="heading"><i class="material-icons">history</i><span>{{'ADMIN.JOBS.LIST' | translate}}</span></div>
    <div class="group">
        <div class="reload"><i class="material-icons clickable" (click)="reloadJobStatus()">refresh</i></div>
        <div class="no-jobs" *ngIf="!jobs || !jobs.length">{{'ADMIN.JOBS.NO_JOBS' | translate}}</div>
        <div *ngFor="let job of jobs;let i=index" class="job">
            <div class="job-col">
                <div class="job-row job-main"
                     [class.status-error]="job.worstLevel.syslogEquivalent<=3"
                     [class.status-warning]="job.worstLevel.syslogEquivalent<=4"
                     [class.status-fine]="job.worstLevel.syslogEquivalent>=6"
                     [class.status-aborted]="job.status=='Aborted'">
                    <div class="job-col col-name">
                        <div class="name">{{job.jobDetail.name}}</div>
                        <div class="class">{{job.jobDetail.jobClass}}</div>
                    </div>
                    <div class="job-col col-time">
                        <div class="date">
                            {{job.startTime | formatDate:{time:true,relative:false} }}
                            <span *ngIf="job.finishTime">
                                - {{job.finishTime | formatDate:{time:true,relative:false} }}
                            </span>
                        </div>
                        <div class="job-status {{job.status.toLowerCase()}}">
                            <span>
                                {{'ADMIN.JOBS.'+job.status | translate}}
                                <span *ngIf="job.worstLevel.syslogEquivalent==4">{{'ADMIN.JOBS.WITH_WARNINGS' | translate}}</span>
                                <span *ngIf="job.worstLevel.syslogEquivalent<4">{{'ADMIN.JOBS.WITH_ERRORS' | translate}}</span>
                            </span>
                            <spinner-small *ngIf="job.status=='Running'"></spinner-small>
                            <button mat-icon-button *ngIf="job.status=='Running'" (click)="cancelJob(job)" class="close"><i icon iconId="close"></i></button>
                        </div>
                    </div>
                    <div class="job-col col-more" [class.clickable]="job.log && job.log.length" (click)="job.log && job.log.length ? jobsOpen[i]=jobsOpen[i] ? false : true : null">
                        <i class="material-icons" *ngIf="job.log && job.log.length">{{jobsOpen[i] ? 'keyboard_arrow_up' : 'keyboard_arrow_down'}}</i>
                    </div>
                </div>
                <div class="job-col row-detail" *ngIf="jobsOpen[i]">
                    <div class="job-row log-filters">
                        <mat-form-field class="job-row log-filter">
                            <mat-label>{{'ADMIN.JOBS.LOG_FILTER' | translate}}</mat-label>
                            <input matInput type="text" [(ngModel)]="jobsLogFilter[i]" (ngModelChange)="updateJobLogs()">
                        </mat-form-field>
                        <mat-form-field class="job-row log-level">
                            <mat-label for="logLevel">{{'ADMIN.JOBS.LOG_LEVEL' | translate}}</mat-label>
                            <mat-select id="logLevel"[(ngModel)]="jobsLogLevel[i]" (ngModelChange)="updateJobLogs()">
                                <mat-option value="">Alles</mat-option>
                                <mat-option value="4">{{'ADMIN.JOBS.LOG_LEVEL_4' | translate}}</mat-option>
                                <mat-option value="3">{{'ADMIN.JOBS.LOG_LEVEL_3' | translate}}</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div class="job-col">
                        <div class="log">{{'ADMIN.JOBS.LOG' | translate}}</div>
                        <div class="log-data">
                            <div *ngFor="let entry of jobsLogData[i]" class="job-row"
                                 [class.status-error]="entry.level.syslogEquivalent<=3"
                                 [class.status-warning]="entry.level.syslogEquivalent<=4"
                            >
                                <div class="log-level">{{'ADMIN.JOBS.LOG_LEVEL_'+entry.level.syslogEquivalent | translate}}</div>
                                <div class="log-date">{{entry.date | formatDate:{time:true,date:false,relative:false} }}</div>
                                <div class="log-class">{{ entry.className.split(".")[entry.className.split(".").length-1] }}</div>
                                <div class="log-message">{{entry.message}}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div *ngIf="mode=='TOOLKIT'" class="content toolkit">
  <div class="heading"><i class="material-icons">refresh</i><span>{{'ADMIN.TOOLKIT.REFRESH_APP' | translate}}</span></div>
  <div class="group">
    <div class="info">{{'ADMIN.TOOLKIT.REFRESH_APP_INFO' | translate }}</div>
    <div class="btn-flat btn-shadow" (click)="refreshAppInfo()">{{'ADMIN.TOOLKIT.REFRESH_APP' | translate }}</div>
  </div>
  <div class="group">
    <div class="info">{{'ADMIN.TOOLKIT.REFRESH_EDU_GROUP_CACHE' | translate }}</div>
    <div class="btn-flat btn-shadow" (click)="refreshEduGroupCache()">{{'ADMIN.TOOLKIT.REFRESH_EDU_GROUP_CACHE' | translate }}</div>
  </div>
  <div class="heading"><i class="material-icons">cached</i><span>{{'ADMIN.TOOLKIT.CACHE' | translate}}</span></div>
    <div class="group">
        <form (ngSubmit)="getCacheInfo()">
            <input type="text" name="cacheInfo" class="cacheInfo" [(ngModel)]="cacheInfo" placeholder="{{'ADMIN.TOOLKIT.CACHE_NAME' | translate }}">
            <div class="btn-flat btn-shadow" (click)="getCacheInfo()">{{'ADMIN.TOOLKIT.CACHE_INFO' | translate }}</div>
        </form>
    </div>
    <div class="group caches">
        <div class="inputGroup">
            <a class="btn-flat btn-shadow" (click)="chooseDirectory=true">{{'ADMIN.TOOLKIT.CACHE_ROOT_FOLDER' | translate}}</a>
            <div class="directory"><div *ngIf="parentNode">{{ parentNode.name}} ({{parentNode.ref.id}})</div></div>
        </div>
        <div class="group">
            <div class="inputGroup">
                <a class="btn-flat btn-shadow" (click)="refreshCache(false)">{{'ADMIN.TOOLKIT.REFRESH_CACHE' | translate}}</a>
                <a class="btn-flat btn-shadow" (click)="refreshCache(true)">{{'ADMIN.TOOLKIT.STICKY_REFRESH_CACHE' | translate}}</a>
            </div>
        </div>
        <div class="propertyGroup">
            <input type="text" [(ngModel)]="propertyName" placeholder="{{'ADMIN.TOOLKIT.PROPERTY_NAME' | translate}}">
            <a class="btn-flat btn-shadow" (click)="getPropertyValues()">{{'ADMIN.TOOLKIT.PROPERTY_VALUESPACE' | translate}}</a>
        </div>
    </div>
    <div class="heading"><i class="material-icons">file_upload</i><span>{{'ADMIN.TOOLKIT.UPLOAD_TEMP' | translate}}</span></div>
  <div class="group">
    <input #uploadTempSelect type="file" style="display:none" id="uploadTempSelect" (change)="updateUploadTempFile($event)">
    <div class="inputGroup">
      <a class="btn-flat btn-shadow" (click)="uploadTempSelect.click()">{{'ADMIN.TOOLKIT.CHOOSE_UPLOAD_TEMP' | translate}}</a>
      <div class="file">{{ (uploadTempFile ? uploadTempFile.name : '') }}</div>
    </div>
    <a class="btn waves-effect waves-light" (click)="startUploadTempFile()">{{'ADMIN.TOOLKIT.UPLOAD_TEMP_START' | translate}}</a>
  </div>
  <div class="heading"><i class="material-icons">textsms</i><span>{{'ADMIN.TOOLKIT.CATALINA' | translate}}</span></div>
  <div class="group catalina">
    <div class="btn-flat btn-shadow" (click)="refreshCatalina()"><i class="material-icons">refresh</i></div>
    <textarea id="catalina" #catalinaRef [ngModel]="catalina" readonly></textarea>
  </div>
</div>
<div *ngIf="mode=='BROWSER'" class="content browser">
  <div class="heading"><i class="material-icons">search</i><span>{{'ADMIN.BROWSER.NODE_BROWSER' | translate}}</span></div>
    <div class="inputGroupGrow">
        <div class="info">{{'ADMIN.BROWSER.MODE' | translate }}</div>
        <select [(ngModel)]="lucene.mode">
            <option value="NODEREF">Node-Ref / Node-Id</option>
            <option value="SOLR">Solr / Lucene Query</option>
        </select>
    </div>
    <div *ngIf="lucene.mode=='NODEREF'" class="group">
        <div class="inputGroupGrow">
            <div class="info">{{'ADMIN.BROWSER.NODEREF' | translate }}</div>
            <input type="text" name="noderef" [(ngModel)]="lucene.noderef" placeholder='aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee"'>
        </div>
        <a class="btn waves-effect waves-light" (click)="searchNoderef()">{{'ADMIN.BROWSER.LUCENE_START' | translate}}</a>
    </div>
  <div *ngIf="lucene.mode=='SOLR'" class="group">
    <div class="inputGroupGrow">
      <div class="info">{{'ADMIN.BROWSER.LUCENE_QUERY' | translate }}</div>
      <textarea name="luceneQuery" class="materialize-textarea" [(ngModel)]="lucene.query" placeholder='@cm\:name:"*"'></textarea>
    </div>
      <div class="inputGroupGrow">
          <div class="info">{{'ADMIN.BROWSER.OUTPUT_MODE' | translate }}</div>
            <mat-radio-group [(ngModel)]="lucene.outputMode">
                <mat-radio-button name="solrMode" value="view">{{'ADMIN.BROWSER.OUTPUT_MODE_VIEW' | translate}}</mat-radio-button>
                <mat-radio-button name="solrMode" value="export">{{'ADMIN.BROWSER.OUTPUT_MODE_EXPORT' | translate}}</mat-radio-button>
            </mat-radio-group>
      </div>
      <div class="inputGroupGrow" *ngIf="lucene.outputMode=='export'">
          <div class="info">{{'ADMIN.BROWSER.LUCENE_EXPORT_PROPERTIES_HINT' | translate }}</div>
          <textarea class="materialize-textarea export-properties" [(ngModel)]="lucene.properties"></textarea>
      </div>
      <div class="inputGroupGrow" *ngIf="lucene.outputMode=='export'">
          <div class="info">{{'ADMIN.BROWSER.OUTPUT_MODE' | translate }}</div>
          <div>
              <input type="radio" name="exportFormat" id="exportFormatCSV" [(ngModel)]="lucene.exportFormat" value="csv"><label for="exportFormatCSV">{{'ADMIN.BROWSER.EXPORT_FORMAT_CSV' | translate}}</label>
              <input type="radio" name="exportFormat" id="exportFormatJSON" [(ngModel)]="lucene.exportFormat" value="json"><label for="exportFormatJSON">{{'ADMIN.BROWSER.EXPORT_FORMAT_JSON' | translate}}</label>
          </div>
      </div>
      <div class="inputGroupGrow" *ngIf="lucene.outputMode=='export'">
          <div></div>
          <div><a class="btn waves-effect waves-light" (click)="exportLucene()">{{'ADMIN.BROWSER.LUCENE_EXPORT_START' | translate}}</a></div>
      </div>
    <div class="inputGroupGrow" *ngIf="lucene.outputMode=='view'">
      <div class="info">{{'ADMIN.BROWSER.LUCENE_AUTHORITIES' | translate }}</div>
      <authority-search-input [globalSearchAllowed]="true" [placeholder]="'ADMIN.BROWSER.ADD_AUTHORITY'" [allowAny]="true" (onChooseAuthority)="addLuceneAuthority($event)"></authority-search-input>
    </div>
    <div class="inputGroupGrow luceneAuthorities" *ngIf="lucene.outputMode=='view' && lucene.authorities && lucene.authorities.length">
        <div></div>
        <mat-chip-list>
          <mat-chip *ngFor="let authority of lucene.authorities" (removed)="removeLuceneAuthority(authority)">
            <span>{{authority | authorityName}}</span>
            <i matChipRemove icon iconId="cancel"></i>
          </mat-chip>
        </mat-chip-list>
    </div>
  <div class="inputGroupGrow lucenePaging" *ngIf="lucene.outputMode=='view'">
      <div class="info">{{'ADMIN.BROWSER.LUCENE_OFFSET' | translate }}</div>
      <input type="number" name="luceneOffset" [(ngModel)]="lucene.offset">
      <div class="info">{{'ADMIN.BROWSER.LUCENE_COUNT' | translate }}</div>
      <input type="number" name="luceneCount" [(ngModel)]="lucene.count">
      <a class="btn waves-effect waves-light" (click)="searchLucene()">{{'ADMIN.BROWSER.LUCENE_START' | translate}}</a>
  </div>
  </div>
    <div *ngIf="lucene.mode=='NODEREF' || lucene.outputMode=='view'" class="search-list">
        <listTable
                [viewType]="0"
                [columns]="searchColumns"
                [hasHeading]="true"
                [nodes]="luceneNodes"
                [hasCheckbox]="true"
                [hasIcon]="true"
                [totalCount]="luceneCount"
                [isClickable]="true"
                (clickRow)="debugNode($event.node)"
        ></listTable>
    </div>
</div>
<div *ngIf="mode=='FOLDERTEMPLATES'" class="content foldertemplates">
  <form (ngSubmit)="applyTemplate()">
    <autocomplete
            [id]="eduGroup"
            [inputMinLength]="2"
            (addItem)="addEduGroup($event)"
            [placeholder]="'ADMIN.FOLDERTEMPLATES.EDUGROUP'"
            [suggestions]="eduGroupSuggestions"
            (updateInput)="updateEduGroupSuggestions($event)"
    ></autocomplete>
    <div class="eduGroupsSelected">
      <div class="badge" *ngFor="let eduGroup of eduGroupsSelected">
        <span>{{eduGroup.title}}</span>
        <i class="material-icons clickable" (click)="removeEduGroup(eduGroup)">cancel</i>
      </div>
    </div>
    <select [(ngModel)]="selectedTemplate" name="template">
      <option *ngFor="let option of templates">{{ option }}</option>
    </select>
    <a class="goto-folder clickable" (click)="gotoFoldertemplateFolder()">{{'ADMIN.FOLDERTEMPLATES.GOTO_FOLDERTEMPLATES' | translate }}</a>
    <div class="btn btn-shadow" (click)="applyTemplate()">{{'ADMIN.FOLDERTEMPLATES.APPLYTEMPLATE' | translate }}</div>
  </form>
  <div class="group">
    <input #templateSelect type="file" style="display:none" id="templateSelect" accept="application/xml" (change)="uploadTemplate($event)" />
    <div class="btn-flat btn-shadow btnXml" (click)="templateSelect.click()">{{'ADMIN.FOLDERTEMPLATES.UPLOAD_TEMPLATE' | translate}}</div>
    <div class="upload-hint">{{'ADMIN.FOLDERTEMPLATES.UPLOAD_HINT' | translate}}</div>
  </div>
</div>
</div>
</div>
<global-progress *ngIf="globalProgress"></global-progress>

<!-- <app-search-header></app-search-header> -->
<global-progress *ngIf="globalProgress"></global-progress>
<main-nav *ngIf="mainnav"
  [title]="'COLLECTIONS.TITLE'"
  [currentScope]="'collections'"
  [searchEnabled]="false"
></main-nav>
<collections-manage-pinning
  *ngIf="addPinning"
  [addCollection]="addPinning"
  (onClose)="addPinning=null"
></collections-manage-pinning>


<div [class.collectionsContainerMainnav]="mainnav" class="collectionsContainer">

<div class="row tab-group row-dark" *ngIf="isRootLevelCollection() && !isGuest">
  <div class="col s12">
    <ul class="tabs">

      <!-- replace table tabs with Angular Material 2 tabs when those are production ready-->

      <li class="clickable tab col s4" [class.s4]="hasOrganizations" [class.s6]="!hasOrganizations" (click)="selectTabMyCollections()">
        <a class="table-tab-title-long" [class.active]="(tabSelected==='MY')">{{ 'collections_myCollectionsLong' | translate }}</a>
        <a class="table-tab-title-short" [class.active]="(tabSelected==='MY')">{{ 'collections_myCollectionsShort' | translate }}</a>
      </li>
      <li class="clickable tab col" [class.s4]="hasOrganizations" [class.s6]="!hasOrganizations" (click)="selectTabMyOrganizations()" *ngIf="hasOrganizations">
        <a class="table-tab-title-long" [class.active]="(tabSelected==='EDU_GROUPS')">{{ 'collections_orgaCollectionsLong' | translate }}</a>
        <a class="table-tab-title-short" [class.active]="(tabSelected==='EDU_GROUPS')">{{ 'collections_orgaCollectionsShort' | translate }}</a>
      </li>
      <li class="clickable tab col" [class.s4]="hasOrganizations" [class.s6]="!hasOrganizations" (click)="selectTabAllCollections()">
        <a class="table-tab-title-long" [class.active]="(tabSelected==='EDU_ALL')">{{ 'collections_allCollectionsLong' | translate }}</a>
        <a class="table-tab-title-short" [class.active]="(tabSelected==='EDU_ALL')">{{ 'collections_allCollectionsShort' | translate }}</a>
      </li>
    </ul>
  </div>
</div>
  <section *ngIf="(isLoading || (!isReady))" class="collections-loading-div" style="padding-top: 24px;text-align: center;">
    <spinner></spinner>
  </section>
  <div class="collections-master-div" [class.collections-master-div-notabs]="!isRootLevelCollection()">

    <a *ngIf="!isLoading && isGuest" class="clickable switchToSearch" title="{{'COLLECTIONS.TO_SEARCH' | translate}}" tabindex="0" (click)="navigateToSearch()" (keypress)="($event.which === 13)?navigateToSearch():0">{{'COLLECTIONS.TO_SEARCH' | translate}} <i class="material-icons">arrow_forward</i></a>


<!-- breadcrumbs -->
  <breadcrumbs *ngIf="!isRootLevelCollection() && !isLoading" class="collections-breadcrumb"
    [home]="tabSelected=='MY'?'collections_myCollectionsLong':tabSelected=='EDU_GROUPS'?'collections_orgaCollectionsLong':'collections_allCollectionsLong'"
    [breadcrumbsAsNode]="path"
    [canDrop]="canDropOnCollection"
    (onDrop)="dropOnCollection($event)"
    (onClick)="openBreadcrumb($event)"
  ></breadcrumbs>
<!-- collection header -->
<div *ngIf="(!isRootLevelCollection()) && (!isLoading) && isReady && (tabSelected.length>=-1)" [class.collections-headerMainnav]="mainnav" class="collections-header" [style.background-color]="collectionContent.collection.color">

        <div class="card-collection-image-container" style="width:100%;">

            <div *ngIf="collectionContent.collection.preview.isIcon" style="width: 250px; height: 200px; margin-left: auto;
    margin-right: auto;" >
                <div class="card-image-icon-container">
                  <div class="card-image-icon-circle">
                    <i class="material-icons" style="font-size: 75px; margin-top: 42px;" [style.color]="collectionContent.collection.color">layers</i>
                  </div>
                </div>
            </div>

            <div *ngIf="!collectionContent.collection.preview.isIcon" class="card-image-icon-container">
                <img class="collection-header-image" [src]="collectionContent.collection.preview.url+'&crop=true&width=250&height=200'" (error)="collectionContent.collection.previewUrl=null" style="width: 100%; height: auto;" role="presentation"/>
            </div>

        </div>
        <div *ngIf="pinningAllowed && isAllowedToEditCollection() " class="collections-pin-button"
             tabindex="0"
             (keypress)="($event.which === 13)?pinCollection():0"
             (click)="pinCollection()"
        >
          <custom-icon iconId="pin"></custom-icon>
        </div>
       <div *ngIf="isAllowedToEditCollection() " class="collections-edit-button"
            tabindex="0"
            (keypress)="($event.which === 13)?buttonCollectionEdit():0"
            (click)="buttonCollectionEdit()"
       >
                <i class="material-icons" style="display:inline;">edit</i>
            </div>

       <div *ngIf="isAllowedToDeleteCollection()" class="collections-delete-button"
            tabindex="0"
            (keypress)="($event.which === 13)?buttonCollectionDelete():0"
            (click)="buttonCollectionDelete()">
                <i class="material-icons" style="display:inline;">delete</i>
        </div>

        <div class="collections-header-textarea">

            <div class="collection-new-preview-headline collections-header-texttop" style="overflow:hidden;">
                {{collectionContent.collection.title}}
            </div>

            <div *ngIf="(collectionContent.collection.childReferencesCount>=collectionContent.collection.childCollectionsCount)" class="collection-new-preview-subline collections-header-texttop">{{collectionContent.collection.childReferencesCount}} {{ 'COLLECTION.INFO_CHILDS_MULTI' | translate }}
            </div>

            <div *ngIf="(collectionContent.collection.childReferencesCount<collectionContent.collection.childCollectionsCount)" class="collection-new-preview-subline collections-header-texttop">{{collectionContent.collection.childCollectionsCount}} {{ 'COLLECTION.INFO_REFERENCES_MULTI' | translate }}
            </div>

            <div class="collection-new-preview-infoline">
                <i class="material-icons icon-bottom">person</i> {{collectionContent.collection.owner.profile.firstName}} {{collectionContent.collection.owner.profile.lastName}}</div>

            <div *ngIf="(getPrivacyScope(collectionContent.collection)=='')"
                class="collection-new-preview-infoline">
                <i class="material-icons icon-bottom">help outline</i>&nbsp;...
           </div>
            <div *ngIf="(getPrivacyScope(collectionContent.collection)=='MY')"
                class="collection-new-preview-infoline">
                <i class="material-icons icon-bottom">lock</i>&nbsp;{{ 'COLLECTION.SCOPE.MY' | translate }}
           </div>
           <div *ngIf="(getPrivacyScope(collectionContent.collection)=='EDU_GROUPS' || getPrivacyScope(collectionContent.collection)=='CUSTOM')"
                class="collection-new-preview-infoline">
                <i class="material-icons icon-bottom">group</i>&nbsp;{{ 'COLLECTION.SCOPE.SHARED' | translate }}
           </div>
            <div *ngIf="(getPrivacyScope(collectionContent.collection)=='EDU_ALL' || getPrivacyScope(collectionContent.collection)=='CUSTOM_PUBLIC')"
                class="collection-new-preview-infoline">
                <i class="material-icons icon-bottom">language</i>&nbsp;{{ 'COLLECTION.SCOPE.PUBLIC' | translate }}
           </div>

           <div class="collection-description" style="margin-top:16px;opacity:0.85;">{{ 'collections_description' | translate }}</div>

           <div class="collection-description" style="margin-top:5px;">
               {{collectionContent.collection.description}}
               <span *ngIf="(collectionContent.collection.description==null) || (collectionContent.collection.description.length==0)" style="padding:2px;">-</span>
           </div>

        </div>


</div>



<!-- content (collection cards) if not error -->

<section class="collections-cards-div" *ngIf="((lastError==null) && (!isLoading))" >

                <div class="section-headline" *ngIf="isAllowedToEditCollection() || collectionContent.collections.length">{{ 'COLLECTION.INFO_REFERENCES_MULTI' | translate }}</div>

                <!-- COLLECTION CARDS -->
                <listTable
                  [addElement]="isAllowedToEditCollection() ? createCollectionElement : null"
                  [hasHeading]="false"
                  [isLoading]="isLoading"
                  [viewType]="isRootLevelCollection() ? 1 : 2"
                  [dragDrop]="true"
                  [canDrop]="canDropOnCollection"
                  (onDrop)="dropOnCollection($event)"
                  [columns]="collectionsColumns"
                  [isClickable]="true"
                  (clickRow)="onCollectionsClick($event)"
                  (onAddElement)="onCreateCollection()"
                  [nodes]="collectionContent.collections"
                ></listTable>

                <!-- when empty at root level -->
                <div *ngIf="(collectionContent.collections.length==0) && (isRootLevelCollection())" class="section-headline collection-nocontent-container">
                    <div *ngIf="tabSelected=='EDU_GROUPS'" class="collection-nocontent-big">
                        {{ 'collections_noOrgaCollections' | translate }}
                    </div>
                    <div *ngIf="tabSelected=='EDU_ALL'" class="collection-nocontent-big">
                        {{ 'collections_noCollections' | translate }}
                    </div>
                </div>

</section>

<!-- content (content cards) if not error -->
<section class="collections-cards-div" *ngIf="((lastError==null) && (!isLoading) && (isReady) && !isRootLevelCollection())" >

                <div class="section-headline">{{ 'collections_content' | translate }}</div>

                <listTable
                  [addElement]="isUserAllowedToEdit(collectionContent.collection) ? createCollectionReference : null"
                  [hasHeading]="false"
                  [isLoading]="isLoading"
                  [viewType]="1"
                  [dragDrop]="true"
                  [columns]="referencesColumns"
                  [options]="listOptions"
                  [isClickable]="true"
                  [canDrop]="canDropOnRef"
                  (clickRow)="onContentClick($event)"
                  (onAddElement)="switchToSearch()"
                  [canDelete]="canDelete"
                  (onDelete)="deleteReference($event)"
                  [nodes]="collectionContent.references"
                ></listTable>

                <!-- NO CONTENT NOTICE -->
                <div *ngIf="collectionContent.references.length==0" class="section-headline collection-nocontent-container">
                    <div class="collection-nocontent-big">
                        {{ 'collections_noContentAvailable' | translate }}
                    </div>
                    <div class="collection-nocontent-small" *ngIf="(isUserAllowedToEdit(collectionContent.collection))">
                        {{ 'collections_howToAddContent' | translate }}
                    </div>
                </div>

</section>

<section class="collections-cards-div" *ngIf="((lastError==null) && (!isLoading) && (isReady) && !isRootLevelCollection())" style="padding-bottom: 10px;">
    <div *ngIf="collectionContent.references.length>0" style="padding-top:8px;">&nbsp;</div>
</section>

<!-- error if present-->
<section *ngIf="(lastError!=null)" style="text-align: center;">
    <p style="color:red;">{{lastError}}</p>
    <button md-raised-button color="warn" (click)="resetCollections()">{{ 'collections_reload' | translate }}</button>
</section>

</div>

  <modal-dialog *ngIf="dialogTitle"
                [title]="dialogTitle"
                [isCancelable]="dialogCancelable"
                (onCancel)="closeDialog()"
                [message]="dialogMessage"
                [buttons]="dialogButtons"
  ></modal-dialog>

  <workspace-management
    [(nodeReport)]="nodeReport"
    [(addToCollection)]="addToOther"
    (onCloseAddToCollection)="closeAddToOther()"
  ></workspace-management>
</div>
